<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora IVA e ISR (El Salvador)</title>
  <style>
    :root {
      --bg-body: #f4f5f7;
      --bg-card: #ffffff;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border: #d1d5db;
      --shadow: 0 4px 16px rgba(0,0,0,0.08);
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --input-bg: #ffffff;
      --resultado-bg: #f3f4f6;
    }

    body.dark {
      --bg-body: #111827;
      --bg-card: #1f2937;
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --border: #374151;
      --shadow: 0 4px 20px rgba(0,0,0,0.5);
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --input-bg: #111827;
      --resultado-bg: #111827;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg-body);
      color: var(--text-main);
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      transition: background 0.3s ease, color 0.3s ease;
    }
    .card {
      background: var(--bg-card);
      padding: 22px;
      border-radius: 18px;
      box-shadow: var(--shadow);
      max-width: 520px;
      width: 100%;
      transition: background 0.3s ease, box-shadow 0.3s ease;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    h1 {
      font-size: 1.3rem;
      margin: 0;
    }
    .theme-toggle {
      font-size: 0.8rem;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text-main);
      cursor: pointer;
    }
    .tabs {
      display: flex;
      gap: 8px;
      margin: 12px 0 18px;
      flex-wrap: wrap;
    }
    .tab-btn {
      flex: 1;
      padding: 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #e5e7eb;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      color: #111827;
    }
    body.dark .tab-btn {
      background: #374151;
      color: #e5e7eb;
      border-color: #4b5563;
    }
    .tab-btn.active {
      background: var(--primary);
      color: #ffffff;
      border-color: var(--primary-dark);
    }
    label {
      font-weight: 600;
      margin-top: 10px;
      display: block;
      font-size: 0.9rem;
    }
    input, select {
      width: 100%;
      padding: 9px;
      border-radius: 8px;
      border: 1px solid var(--border);
      margin-top: 6px;
      font-size: 0.95rem;
      box-sizing: border-box;
      background: var(--input-bg);
      color: var(--text-main);
    }
    button.action {
      width: 100%;
      background: var(--primary);
      color: white;
      padding: 11px;
      border: none;
      border-radius: 999px;
      margin-top: 16px;
      font-weight: bold;
      font-size: 0.95rem;
      cursor: pointer;
    }
    button.action:hover {
      background: var(--primary-dark);
    }
    .resultado {
      margin-top: 16px;
      padding: 12px;
      background: var(--resultado-bg);
      border-radius: 12px;
      display: none;
      font-size: 0.95rem;
      border: 1px solid var(--border);
    }
    .resultado p {
      margin: 4px 0;
    }
    hr {
      margin: 10px 0;
      border: none;
      border-top: 1px solid var(--border);
    }
    .nota {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 8px;
      text-align: center;
      line-height: 1.3;
    }
    .seccion {
      display: none;
    }
    .seccion.activa {
      display: block;
    }
    .contacto {
      margin-top: 18px;
      padding-top: 10px;
      font-size: 0.85rem;
      text-align: center;
      color: var(--text-main);
      border-top: 1px solid var(--border);
    }
  </style>
</head>
<body class="dark"><!-- arranca en modo oscuro -->

  <div class="card">
    <div class="card-header">
      <h1>Calculadora IVA e ISR</h1>
      <button class="theme-toggle" onclick="toggleTheme()">üåô / ‚òÄÔ∏è</button>
    </div>

    <!-- BOTONES DE SELECCI√ìN -->
    <div class="tabs">
      <button class="tab-btn active" onclick="mostrarSeccion('iva')">1) IVA</button>
      <button class="tab-btn" onclick="mostrarSeccion('isr')">2) ISR / Retenci√≥n</button>
      <button class="tab-btn" onclick="mostrarSeccion('combo')">3) IVA + ISR combinado</button>
    </div>

    <!-- SECCI√ìN IVA -->
    <div id="sec-iva" class="seccion activa">
      <h2 style="font-size:1.05rem; margin-bottom:6px; text-align:center;">üßæ C√°lculo de IVA</h2>

      <label for="netoIva">Monto que quiero recibir (neto, sin IVA):</label>
      <input type="number" id="netoIva" step="0.01" placeholder="Ej: 176.99">

      <label for="iva">IVA (%):</label>
      <input type="number" id="iva" value="13" step="0.01">

      <button class="action" onclick="calcularIVA()">Calcular total con IVA</button>

      <div id="resultadoIva" class="resultado"></div>

      <div class="nota">
        F√≥rmula: Total a cobrar = Neto √ó (1 + IVA%).<br>
        Ejemplo: 176.99 √ó 1.13 ‚âà 200.00
      </div>
    </div>

    <!-- SECCI√ìN ISR -->
    <div id="sec-isr" class="seccion">
      <h2 style="font-size:1.05rem; margin-bottom:6px; text-align:center;">üí∏ C√°lculo de ISR / Retenci√≥n</h2>

      <label for="netoIsr">Monto que quiero recibir NETO (despu√©s de retenciones):</label>
      <input type="number" id="netoIsr" step="0.01" placeholder="Ej: 35.00">

      <label for="tipoContribuyenteSoy">¬øQu√© tipo de contribuyente soy?</label>
      <select id="tipoContribuyenteSoy">
        <option value="pequeno">Peque√±o contribuyente</option>
        <option value="mediano">Mediano contribuyente</option>
        <option value="grande">Gran contribuyente</option>
      </select>

      <label for="tipoCliente">¬øA qu√© tipo de cliente le facturo?</label>
      <select id="tipoCliente">
        <option value="gran">Gran contribuyente / Gobierno</option>
        <option value="mediano">Mediano contribuyente</option>
        <option value="otro">Otro / Peque√±o contribuyente</option>
      </select>

      <button class="action" onclick="calcularISR()">Calcular cu√°nto debo cobrar</button>

      <div id="resultadoIsr" class="resultado"></div>

      <div class="nota">
        Supuestos referenciales (base contable simple):<br>
        ‚Ä¢ Tasa base de retenci√≥n ISR seg√∫n tu categor√≠a de contribuyente (por defecto 10%).<br>
        ‚Ä¢ Si el cliente es <strong>Gran contribuyente / Gobierno</strong>, se suma 1% adicional de retenci√≥n.<br>
        *Ajusta los porcentajes en el c√≥digo seg√∫n la normativa vigente y criterio de tu contador.*
      </div>

      <div class="contacto">
        Contacto: <strong>7242-8259</strong><br>
        <strong>Lic. N√©stor Gonz√°lez</strong>
      </div>
    </div>

    <!-- SECCI√ìN COMBINADA IVA + ISR -->
    <div id="sec-combo" class="seccion">
      <h2 style="font-size:1.05rem; margin-bottom:6px; text-align:center;">üìä IVA + ISR combinado</h2>

      <label for="netoCombo">Monto que quiero recibir NETO (despu√©s de ISR, antes de gastos):</label>
      <input type="number" id="netoCombo" step="0.01" placeholder="Ej: 176.99">

      <label for="tipoContribuyenteSoyCombo">¬øQu√© tipo de contribuyente soy?</label>
      <select id="tipoContribuyenteSoyCombo">
        <option value="pequeno">Peque√±o contribuyente</option>
        <option value="mediano">Mediano contribuyente</option>
        <option value="grande">Gran contribuyente</option>
      </select>

      <label for="tipoClienteCombo">¬øA qu√© tipo de cliente le facturo?</label>
      <select id="tipoClienteCombo">
        <option value="gran">Gran contribuyente / Gobierno</option>
        <option value="mediano">Mediano contribuyente</option>
        <option value="otro">Otro / Peque√±o contribuyente</option>
      </select>

      <label for="ivaCombo">IVA (%):</label>
      <input type="number" id="ivaCombo" value="13" step="0.01">

      <button class="action" onclick="calcularCombo()">Calcular total (IVA + ISR)</button>

      <div id="resultadoCombo" class="resultado"></div>

      <div class="nota">
        Flujo: partimos del NETO que quieres recibir ‚Üí calculamos la base sin IVA usando ISR ‚Üí luego sumamos el IVA para obtener el total que pagar√° el cliente.
      </div>
    </div>
  </div>

  <script>
    // CONFIGURACI√ìN DE TASAS (puedes ajustarlas si cambia la norma)
    const CONFIG_RETENCIONES = {
      pequeno: 10,  // % base para peque√±o contribuyente
      mediano: 10,  // % base para mediano contribuyente (ajustable)
      grande: 10    // % base para gran contribuyente (ajustable)
    };

    const EXTRA_CLIENTE = {
      gran: 1,      // % extra si el cliente es Gran contribuyente / Gobierno
      mediano: 0,
      otro: 0
    };

    function toggleTheme() {
      document.body.classList.toggle("dark");
    }

    // Cambiar entre secciones
    function mostrarSeccion(seccion) {
      const btns = document.querySelectorAll(".tab-btn");
      const secciones = document.querySelectorAll(".seccion");

      btns.forEach(b => b.classList.remove("active"));
      secciones.forEach(s => s.classList.remove("activa"));

      if (seccion === "iva") {
        btns[0].classList.add("active");
        document.getElementById("sec-iva").classList.add("activa");
      } else if (seccion === "isr") {
        btns[1].classList.add("active");
        document.getElementById("sec-isr").classList.add("activa");
      } else {
        btns[2].classList.add("active");
        document.getElementById("sec-combo").classList.add("activa");
      }
    }

    // C√°lculo IVA
    function calcularIVA() {
      const neto = parseFloat(document.getElementById("netoIva").value);
      const iva = parseFloat(document.getElementById("iva").value);
      const res = document.getElementById("resultadoIva");

      if (isNaN(neto) || neto <= 0) {
        alert("Ingresa un monto neto v√°lido.");
        return;
      }
      if (isNaN(iva) || iva < 0) {
        alert("Ingresa un porcentaje de IVA v√°lido.");
        return;
      }

      const total = neto * (1 + iva / 100);
      const ivaMonto = total - neto;

      res.style.display = "block";
      res.innerHTML = `
        <p><strong>Neto (sin IVA):</strong> $${neto.toFixed(2)}</p>
        <p><strong>IVA (${iva}%):</strong> $${ivaMonto.toFixed(2)}</p>
        <hr>
        <p><strong>Total a cobrar (con IVA):</strong> $${total.toFixed(2)}</p>
      `;
    }

    // C√°lculo ISR solo
    function calcularISR() {
      const neto = parseFloat(document.getElementById("netoIsr").value);
      const tipoContribuyente = document.getElementById("tipoContribuyenteSoy").value;
      const tipoCliente = document.getElementById("tipoCliente").value;
      const res = document.getElementById("resultadoIsr");

      if (isNaN(neto) || neto <= 0) {
        alert("Ingresa un monto neto v√°lido.");
        return;
      }

      const retBase = CONFIG_RETENCIONES[tipoContribuyente] || 0;
      const extra = EXTRA_CLIENTE[tipoCliente] || 0;
      const tasaTotal = retBase + extra;
      const factor = 1 - (tasaTotal / 100);

      if (factor <= 0) {
        alert("La suma de retenciones no puede ser 100% o m√°s.");
        return;
      }

      const bruto = neto / factor;
      const montoISR = bruto * (retBase / 100);
      const montoExtra = bruto * (extra / 100);

      const textoContribuyente =
        tipoContribuyente === "pequeno" ? "Peque√±o contribuyente" :
        tipoContribuyente === "mediano" ? "Mediano contribuyente" :
        "Gran contribuyente";

      const textoCliente =
        tipoCliente === "gran" ? "Gran contribuyente / Gobierno" :
        tipoCliente === "mediano" ? "Mediano contribuyente" :
        "Otro / Peque√±o contribuyente";

      res.style.display = "block";
      res.innerHTML = `
        <p><strong>Tipo de contribuyente (t√∫):</strong> ${textoContribuyente}</p>
        <p><strong>Tipo de cliente:</strong> ${textoCliente}</p>
        <p><strong>Neto que deseas recibir:</strong> $${neto.toFixed(2)}</p>
        <p><strong>Tasa base ISR (${retBase}%):</strong> $${montoISR.toFixed(2)}</p>
        <p><strong>Retenci√≥n adicional (${extra}%):</strong> $${montoExtra.toFixed(2)}</p>
        <hr>
        <p><strong>Total retenido (${tasaTotal}%):</strong> $${(montoISR + montoExtra).toFixed(2)}</p>
        <p><strong>Monto total a cobrar (bruto, sin IVA):</strong> $${bruto.toFixed(2)}</p>
      `;
    }

    // C√°lculo combinado IVA + ISR
    function calcularCombo() {
      const neto = parseFloat(document.getElementById("netoCombo").value);
      const tipoContribuyente = document.getElementById("tipoContribuyenteSoyCombo").value;
      const tipoCliente = document.getElementById("tipoClienteCombo").value;
      const iva = parseFloat(document.getElementById("ivaCombo").value);
      const res = document.getElementById("resultadoCombo");

      if (isNaN(neto) || neto <= 0) {
        alert("Ingresa un monto neto v√°lido.");
        return;
      }
      if (isNaN(iva) || iva < 0) {
        alert("Ingresa un porcentaje de IVA v√°lido.");
        return;
      }

      const retBase = CONFIG_RETENCIONES[tipoContribuyente] || 0;
      const extra = EXTRA_CLIENTE[tipoCliente] || 0;
      const tasaTotal = retBase + extra;
      const factor = 1 - (tasaTotal / 100);

      if (factor <= 0) {
        alert("La suma de retenciones no puede ser 100% o m√°s.");
        return;
      }

      // 1) Partimos del neto -> sacamos base sin IVA
      const baseSinIVA = neto / factor;

      // 2) IVA sobre la base
      const montoIVA = baseSinIVA * (iva / 100);
      const totalCliente = baseSinIVA + montoIVA;

      const montoISR = baseSinIVA * (retBase / 100);
      const montoExtra = baseSinIVA * (extra / 100);

      const textoContribuyente =
        tipoContribuyente === "pequeno" ? "Peque√±o contribuyente" :
        tipoContribuyente === "mediano" ? "Mediano contribuyente" :
        "Gran contribuyente";

      const textoCliente =
        tipoCliente === "gran" ? "Gran contribuyente / Gobierno" :
        tipoCliente === "mediano" ? "Mediano contribuyente" :
        "Otro / Peque√±o contribuyente";

      res.style.display = "block";
      res.innerHTML = `
        <p><strong>Tipo de contribuyente (t√∫):</strong> ${textoContribuyente}</p>
        <p><strong>Tipo de cliente:</strong> ${textoCliente}</p>
        <p><strong>Neto que deseas recibir (despu√©s de ISR):</strong> $${neto.toFixed(2)}</p>
        <p><strong>Base sin IVA:</strong> $${baseSinIVA.toFixed(2)}</p>
        <p><strong>Retenci√≥n ISR (${retBase}%):</strong> $${montoISR.toFixed(2)}</p>
        <p><strong>Retenci√≥n adicional (${extra}%):</strong> $${montoExtra.toFixed(2)}</p>
        <p><strong>IVA (${iva}%):</strong> $${montoIVA.toFixed(2)}</p>
        <hr>
        <p><strong>Total que paga el cliente (con IVA):</strong> $${totalCliente.toFixed(2)}</p>
      `;
    }
  </script>
</body>
</html>
